using Godot;

public partial class ModelPositionManager : Node
{

    [Export] public float MoveSpeed = 0.1f;
    [Export] public float RotateSpeed = 1.0f;
    [Export] public float ZoomScale = 0.1f;

    [OnReady("%MoveLeftBtn")] private Button _moveLeftBtn;
    [OnReady("%MoveRightBtn")] private Button _moveRightBtn;
    [OnReady("%MoveUpBtn")] private Button _moveUpBtn;
    [OnReady("%MoveDownBtn")] private Button _moveDownBtn;
    [OnReady("%RotateXAxisBtn")] private Button _rotateXAxisBtn;
    [OnReady("%RotateYAxisBtn")] private Button _rotateYAxisBtn;
    [OnReady("%ZoomInBtn")] private Button _zoomInBtn;
    [OnReady("%ZoomOutBtn")] private Button _zoomOutBtn;

    [OnReady("%ZoomTransfNodeGroup")] private TransformUiGroup _zoomTransfNodeGroup;
    [OnReady("%PositionTransfNodeGroup")] private TransformUiGroup _positionTransfNodeGroup;
    [OnReady("%RotationTransfNodeGroup")] private TransformUiGroup _rotationTransfNodeGroup;

    public Node3D ModelNode;
    public Camera3D CameraNode;
    private bool _isModeLeftBtnHeld = false;

    public override void _Ready()
    {
        _moveLeftBtn.Pressed += MoveModelLeft;
        _moveRightBtn.Pressed += MoveModelRight;
        _moveUpBtn.Pressed += MoveModeUp;
        _moveDownBtn.Pressed += MoveModeDown;

        _rotateXAxisBtn.Pressed += RotateModeXAxis;
        _rotateYAxisBtn.Pressed += RotateModeYAxis;

        _zoomInBtn.Pressed += ZoomModelIn;
        _zoomOutBtn.Pressed += ZoomModelOut;


        //Test for future code to track button being held down
        // _moveLeftBtn.ButtonDown += () => { _isModeLeftBtnHeld = true; };
        // _moveLeftBtn.ButtonUp += () => { _isModeLeftBtnHeld = false; };

        //Check if the ModelNode is not null
        this.CallDeferred(MethodName.CheckIfModelLoaded);

        this.CallDeferred(MethodName.LoadTransformValueToUI);


    }

    private void ConnectTransformUINodeSignals()
    {
        //_zoomTransfNodeGroup
    }

    private void LoadTransformValueToUI()
    {
        _positionTransfNodeGroup.XAxisLabelLineTextEdit.Text = ModelNode.Position.X.ToString();
        _positionTransfNodeGroup.YAxisLabelLineTextEdit.Text = ModelNode.Position.Y.ToString();
        _positionTransfNodeGroup.ZAxisLabelLineTextEdit.Text = ModelNode.Position.Z.ToString();

        _zoomTransfNodeGroup.XAxisLabelLineTextEdit.Text = CameraNode.Size.ToString();
        //_zoomTransfNodeGroup.YAxisLabelLineTextEdit.Text = CameraNode.Scale.Y.ToString();
        //_zoomTransfNodeGroup.ZAxisLabelLineTextEdit.Text = CameraNode.Scale.Z.ToString();

        _rotationTransfNodeGroup.XAxisLabelLineTextEdit.Text = ModelNode.Rotation.X.ToString();
        _rotationTransfNodeGroup.YAxisLabelLineTextEdit.Text = ModelNode.Rotation.Y.ToString();
        _rotationTransfNodeGroup.ZAxisLabelLineTextEdit.Text = ModelNode.Rotation.Z.ToString();
    }

    private void ZoomModelOut()
    {
        CameraNode.Size += ZoomScale;
    }


    private void ZoomModelIn()
    {
        CameraNode.Size -= ZoomScale;
    }


    public override void _Process(double delta)
    {
        if (_moveLeftBtn.IsPressed())
        {
            //GD.Print("Button Left move is being held down!");
            MoveModelLeft();
        }

        if (_rotateXAxisBtn.IsPressed())
        {
            RotateModeXAxis();
        }

        if (_rotateYAxisBtn.IsPressed())
        {

            RotateModeYAxis();
        }

        LoadTransformValueToUI();
    }

    private void MoveModelLeft()
    {
        ModelNode.Position += new Vector3(-MoveSpeed, 0, 0);
    }

    private void MoveModelRight()
    {
        ModelNode.Position += new Vector3(MoveSpeed, 0, 0);
    }

    private void MoveModeUp()
    {
        ModelNode.Position += new Vector3(0, MoveSpeed, 0);
    }

    private void MoveModeDown()
    {
        ModelNode.Position += new Vector3(0, -MoveSpeed, 0);
    }

    private void RotateModeXAxis()
    {
        ModelNode.RotationDegrees += new Vector3(RotateSpeed, 0, 0);
    }

    private void RotateModeYAxis()
    {
        ModelNode.RotationDegrees += new Vector3(0, RotateSpeed, 0);
    }

    public void CheckIfModelLoaded()
    {
        if (ModelNode == null || CameraNode == null)
        {
            GD.PrintErr("Model or Camera in ModelPositionManager is null");
        }
    }
}
